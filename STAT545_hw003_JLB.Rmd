---
title: "STAT545_hw03_JLB"
output: github_document
---
```{r}
suppressPackageStartupMessages(library(tidyverse)) 
suppressPackageStartupMessages(library(gapminder))
```


** Task 1: Get the maximum and minimum of GDP per capita for all continents. **  

```{r}
max_minGDP = gapminder %>%
  group_by(continent) %>% 
  summarize(minGdp = min(gdpPercap),
            maxGdp = max(gdpPercap)) %>% 
  knitr::kable()
  
```

** Task 2 Look at the spread of GDP per capita within the continents. **  
```{r Task2: Spread GDP}
task2= gapminder %>% 
  #filter(year =="2007") %>% 
  group_by(continent) %>% 
  mutate(varGdp = var(gdpPercap),
         meanGdp = mean(gdpPercap)
         ) 
task2 %>% 
  ggplot(aes(continent, gdpPercap)) + geom_violin(fill = "#FF3366") + geom_jitter(alpha = 0.2) +scale_y_log10() 

task2 %>% 
  ggplot(aes(gdpPercap)) + geom_histogram(bins=15, fill = "#FF3366", colour = "black") + facet_wrap(~continent) + scale_x_log10()

  
  
```

** Task 3 Compute a trimmed mean of life expectancy for different years. Or a weighted mean, weighting by population. Just try something other than the plain vanilla mean. **   
```{r}
#find the 5% trimmed mean of life expectancy. 
gapminder %>%
  group_by(year) %>%
  summarize(mean_lifeExp = mean(lifeExp, trim = .15)) %>% 
  knitr::kable() 
  
gapminder %>%
  group_by(year) %>%
  summarize(mean_lifeExp = mean(lifeExp, trim = .2),
            lifeExpavg = mean(lifeExp)) %>% 
  ggplot(aes(year)) +
  geom_point(aes(y = mean_lifeExp), colour = "blue") +
  geom_point(aes(y = lifeExpavg), colour = "red") +theme_classic()

  
```

** Task 4 How is life expectancy changing over time on different continents? **  
```{r}

gapminder %>% 
  group_by(continent, year) %>% 
  mutate(meanLE = mean(lifeExp)) %>% #compute mean life life expectancy per continent for that year.
  ggplot(aes(year, meanLE)) + #call ggplot
  geom_point( aes(shape= continent)) + #add data points
  geom_line(aes(colour = continent)) + #add line through data
  ggtitle("Mean Life Expectancy by Continent") +
  ylab("Mean Life Expectancy (Years)") +
  xlab("Year") +
  theme_classic()

#plotting the change in life expectancy over time gives an idea of the rate of change over time. For example, while life expectancy in the Americas has increased year over year, the rate at which it is doing so is decreasing. Meanwhile, in Europe, the rate of increase in life expectancy has stayed relatively constant around +1 year since 1962. The only continent that has seen a decrease in life expectancy in this data set is Africa, where there was a decrease in average life expectancy in the year 2002. 

gapminder %>% 
 group_by(continent,year) %>% 
  mutate(meanLE = mean(lifeExp)) %>% #take the mean LE of that continent in that year. 
  group_by(country) %>% #re-group only by country because otherwise the lag( ) function does not work as we want.
  mutate(changeLE = meanLE - lag(meanLE)) %>%  #take the difference in mean LE - this is done over time, as the data is organized as such.
  ggplot(aes(year, changeLE, ymin = -1)) + #call ggplot
  geom_point() + #add the data points
  geom_line(aes(colour = continent)) + #add connecting lines
  facet_wrap(~continent) + 
  geom_line(y=0) +
  theme_classic() +
  ggtitle("Change in Life Expectancy Since Previous Census Year") +
  ylab("Change in Life Expectancy (Years)") +
  xlab("Year")


  
```

Comments:
Across continents, all countries have seen an overall increase in life expectancy over time. 
Some interesting results found:

** Task 5 Report the absolute and/or relative abundance of countries with low life expectancy over time by continent: Compute some measure of worldwide life expectancy – you decide – a mean or median or some other quantile or perhaps your current age. Then determine how many countries on each continent have a life expectancy less than this benchmark, for each year. **    
```{r}
#medLE is the median life expectancy worldwide for each year.
medLE = gapminder %>%
  group_by(year) %>% 
  summarize(medLE = median(lifeExp))
#how many countries on each continent have a life expectancy less than medLE for each year?
medLE

gapminder %>% 
  group_by(year) %>% 
  mutate(medLE = median(lifeExp)) %>% 
  group_by(continent, year) %>% 
  #mutate(n = num(lifeExp < medLE)) %>% 
  knitr::kable()

gapminder %>% 
  group_by(year) %>% 
  mutate(medLE = median(lifeExp)) %>% 
  filter(lifeExp < medLE) %>% 
  group_by(continent, year) %>% 
  tally() %>% 
  knitr::kable()
 
gapminder %>% 
  group_by(year) %>% 
  mutate(medLE = median(lifeExp)) %>% 
  #filter(lifeExp < medLE) %>% 
  ggplot(aes(year, lifeExp)) + geom_jitter(aes(colour = lifeExp < medLE),alpha = 0.33) + facet_wrap(~continent) +
  ggtitle("Life Expectancy Above and Below Worldwide Median") +
  ylab("Life Expectancy") +
  xlab("Year")
  
  
```

** Task 6 Find countries with interesting stories. Open-ended and, therefore, hard. Promising but unsuccessful attempts are encouraged. This will generate interesting questions to follow up on in class. **   

```{r}

```

